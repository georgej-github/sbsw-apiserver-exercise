FROM golang:1.9-alpine as builder

# Install dependencies
RUN apk add --update --no-cache ca-certificates && apk add git gcc libc-dev

# Build
WORKDIR /go/src/github.com/sbsw-apiserver-exercise                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

COPY . ./

RUN GOOS=linux GOARCH=amd64 go build -a -ldflags '-extldflags "-static"' -o /apiserver src/*.go




FROM alpine:3.5

RUN apk update && apk add ca-certificates

COPY --from=builder /apiserver /usr/bin/apiserver
RUN chmod +x /usr/bin/apiserver

ENTRYPOINT ["/usr/bin/apiserver"]